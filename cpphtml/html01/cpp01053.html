<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=x-euc-jp">
<title>ロベールのＣ＋＋教室 - 第５３章 テキストとバイナリ -</title>
</head>
<body bgcolor=white>

<center>
<font size=6>第５３章　テキストとバイナリ</font>
</center>
<hr>

<p>　ファイルを扱う時には、<font color=red>アクセスモード</font>というのを指定します。読み出しモード、書き込みモードというのもそうなのですが、もう１つ重要なモード群があります。今回はそれについて話します。</p>

<hr>

<p>　では、今回の要点です。</p>

<font size=+2 color=red>
<ul>
<li>ファイルは１バイト単位のデータが、メモリと同じように詰まっているだけ。</li>
<li>ファイルの内容を変換するモードにはバイナリ、テキストの２種類がある。</li>
<li>テキストモードでは改行が \n として読み出され、<br>ＯＳに合わせた形で書き込まれる。</li>
<li>ファイルに本質的にバイナリ、テキストの区別があるわけではない。</li>
</ul>
</font>
<p><br></p>

<p>　では、いってみましょう。</p>

<hr>

<p>　みなさんはファイルの中にはどんなデータが入っていると思いますか？　今までの講座を見ていれば、<font color=red>文字も数値データとして扱われる</font>ことを知っていると思います。つまり、テキストファイルも、そうでないファイルも、<font color=red>１バイトデータの羅列にすぎない</font>のでは、と思うことでしょう。それはまさに<font color=red>正解</font>です。このことにおいて<font color=red>特別なファイルは１つもありません</font>。</p>

<p>　これが先ずはじめに頭に入れておくことです。でも、これだけだと別にメモリとなんら変わりないことですよね。そうです。<font color=red>ファイルの中のデータ構造は、メモリと特に何ら変わらないのです</font>。もちろん、ファイルとメモリは全く別のものですが（<a href="cpp01031.html" target="main">第３１章</a>を参照）、データ構造については何ら変わりはありません。</p>

<p>　このデータを<font color=red>そのまま読み出す</font>モードが<font color=red>バイナリモード</font>です。ごく普通の動作ですよね。</p>

<hr>

<p>　しかし、これだけでは不便なことがあります。Ｗｉｎｄｏｗｓ、Ｍａｃ、ＵＮＩＸなどで文字コードが違うのは<a href="cpp01022.html" target="main">第２２章</a>の中の用語集でちょっと触れたと思います。このうち、「あ」や「何」などのような全角文字の扱いについては大体共通しているので問題ありませんが、<font color=red>改行コード</font>についてはそうはいきません。</p>

<p>　改行コードは、ずばり改行を表す文字コードです。<font color=red>ファイル上での</font>改行コードは、Ｗｉｎｄｏｗｓでは \r\n 、Ｍａｃでは \r 、ＵＮＩＸでは \n と、大きく異なります。プログラムを各環境で共通して扱うのにも不便ですし、Ｗｉｎｄｏｗｓの改行コードは２バイトなので改行かどうかの判定が少々面倒です。改行はよく使うものなので、これを便利に扱えると非常に助かります。</p>

<p>　そこで、<font color=red>改行コードを自動的に読み替えてくれるモード</font>があります。それが<font color=red>テキストモード</font>です。「テキスト」モードと、テキストであることをやけに強調した名前になっていますが、やっていることは<font color=red>改行コードの読み替えだけ</font>です。<font color=red>それ以外はバイナリモードと何ら変わりがありません。</font></p>

<p>　読み出すときには、<font color=red>改行は \n として読み出されます</font>。書き込むときには、<font color=red>\n は元の改行コードに変換して書き込まれます</font>（メモリ上のデータは変えられません）。書き込むときの改行コードはＯＳによって変わります。</p>

<p>　重ねて言いますが、テキストモードとバイナリモードの違いはここだけです。これは非常に重要です。しっかり理解しておいて下さい。</p>

<p>　あと、<font color=red>ファイルのデータ自体にバイナリ、テキストの区別があるわけではありません</font>。あくまで、ファイルを読み出す、または書き込む時にデータを変換するだけです。くどいようですが、初心者の中にはここを誤解されている人がかなりいます。しっかり理解しておいて下さい。</p>

<p>　<font color=red>テキストファイル</font>、<font color=red>バイナリファイル</font>という言葉を聞いたことがあるかもしれません。これはどういうことか、と思う人もいるでしょう。しかし、これはファイルが「テキスト」つまり、文字コードのみできちんと形成されているかどうかを表しているだけのことです。ここでいうバイナリ、テキストとはちょっと毛色の違う定義です。<font size=+2 color=red>これらの定義は別物です。</font>混乱しないように注意しましょう。</p>

<hr>

<p>　最後に、アクセスフラグについての補足で終わります。</p>

<p>　ファイルを開くときのフラグに <font color=red><b>b</b> を追加指定するとバイナリモード</font>になります。そして、<font color=red>何も指定しないとテキストモード</font>になります。バイナリモードで使おうとしているのに、うっかり b を指定し忘れるというバグは結構あります。気を付けましょう。</p>

<hr>

<p>　今回も短かったですが、内容は非常に濃いです。どこが重要なのか分からないくらい赤い字が出てきました（笑）。しかし、全てが重要です。このことはきっと役に立つと思いますので、しっかり理解しておいて下さい（くどい？）。</p>

<p>　それでは、くどいかもしれませんが、要点を。</p>

<font size=+2 color=red>
<ul>
<li>ファイルは１バイト単位のデータが、メモリと同じように詰まっているだけ。</li>
<li>ファイルの内容を変換するモードにはバイナリ、テキストの２種類がある。</li>
<li>テキストモードでは改行が \n として読み出され、<br>ＯＳに合わせた形で書き込まれる。</li>
<li>ファイルに本質的にバイナリ、テキストの区別があるわけではない。</li>
</ul>
</font>
<p><br></p>

<p>　では、次回からはもうちょっと突っ込んでファイル操作を行ってみたいと思います。では。</p>

<hr>

<p align=right><a href="cpp01052.html" target="main">第５２章　ファイルのススメ２</a> | <a href="cpp01054.html" target="main">第５４章　ファイルのススメ３</a></p>
<p align=right><font size=-1><i>Last update was done on 2000.7.4</i></font></p>

<p align=right><font size=-1><i>この講座の著作権は<a href="http://www1.kcn.ne.jp/~robe/">ロベール</a>が保有しています</i></font></p>

</body>
</html>
