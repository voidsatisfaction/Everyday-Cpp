<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=x-euc-jp">
<title>ロベールのＣ＋＋教室 - 第７９章 Significance of Errors -</title>
</head>
<body bgcolor=white>

<center>
<font size=6>第７９章　Significance of Errors</font>
</center>
<hr>

<p>　<a href="cpp01077.html" target="main">第７７章</a>で２次元配列の要素数を両方省略したときのコンパイルエラーを紹介しました。あの意味って何なんでしょうね？　その他、いろいろなコンパイルエラーがありますが、一見無茶苦茶なエラーを吐いているように見えることはよくあります。今回は、こういったエラーの暗示するその意味について考えてみたいと思います。</p>

<p>　コンパイルエラーは使っているコンパイラによって変わってきます。一応ここで紹介するのはＶＣ＋＋のエラーです。ある程度は似ていると思いますが、もし極端に内容の異なる場合は独自に研究して下さい。</p>

<hr>

<p>　では、今回の要点です。</p>

<font size=+2 color=red>
<ul>
<li>変なエラーが連続して現れるときは先頭のエラーに注目する。</li>
<li>同じ原因からは大体同じエラーしか出てこない。</li>
<li>ヘッダファイルが原因のエラーがあればビルドを中断しよう。</li>
<li>単独コンパイルを積極的に利用する。</li>
</ul>
</font>
<p><br></p>

<p>　では、いってみましょう。</p>

<hr>

<p>　さて、<a href="cpp01077.html" target="main">第７７章</a>のコンパイルエラーをもう一度見てみましょう。</p>

<center><table border=1>

<tr><th>エラーの原因</th></tr>

<tr><td><pre><font color=blue>char</font> result[][] = {
    <font color=darkcyan>"前者は後者より小さいです。"</font>,
    <font color=darkcyan>"両者は等しいです。"</font>,
    <font color=darkcyan>"前者は後者より大きいです。"</font>,
};</pre></td></tr>

<tr><th>コンパイルエラー</th></tr>

<tr><td><pre>error C2087: '&lt;Unknown&gt;' : 添字が不正です。
error C2117: '前者は後者より小さいです。' : 指定された配列には、初期化子が多すぎます。
error C2117: '両者は等しいです。' : 指定された配列には、初期化子が多すぎます。
error C2117: '前者は後者より大きいです。' : 指定された配列には、初期化子が多すぎます。</pre></td></tr>

</table></center>

<p>　先ず、エラー番号Ｃ２０８７の「&lt;Unknown&gt; : 添字が不正です」です。ヘルプを見ると、このエラーの原因は「複数の添字を持つ配列定義の最初の次元以外の次元の添字の値が指定されていません。」だそうです。ヘルプを見るとよく分かりますが、それにしても何とも分かりにくいエラーメッセージですね。大体 &lt;Unknown&gt; って何なのでしょうか？</p>

<p>　残念ながら &lt;Unknown&gt; というのが何かはよく分かりませんが、とりあえずこのエラーの原因はよく分かりました。</p>

<p>　さぁ、このコードのエラーはその部分だけのはずです。そのエラーメッセージもありました。では、残る３つのエラーメッセージは何者なのでしょうか？</p>

<p>　もちろん、２つ目の添え字に適当に６４とでも入れてやれば、エラーメッセージは全てなくなります。<font color=red>他にエラーなど何もない</font>のです。なのに３つも余分にエラーメッセージが出ているのです。何とも不思議ですね。</p>

<p>　しかし、こういうことはよくあることです。あるエラーが起こると、そこでプログラムの解析に異常が起きます。そこでコンパイラは<font color=red>「ある手段」</font>をもってこのことに対処します。この「ある手段」によってエラーから適切に復帰されればいいのですが、必ずしもそうはなりません。すると、<font color=red>エラーの発生したところからプログラムの解析がおかしくなり、そのまま芋づる式に別のエラーを誘発してしまう</font>わけです。そのエラーは、最早真面目に読む価値はないです。</p>

<p>　このように、何だか関連性のありそうな一連のエラーがあった場合、大抵は<font color=red>初めの数個が重要</font>であるだけで、<font color=red>残りのエラーを一生懸命読む意味はない</font>のです。</p>

<p>　例えば、ここでは添字のないカッコがあるということで、その添字のないカッコには<font color=red>１が入っている</font>と仮定されます。これが「ある手段」です。すると result は実質 char 型の配列になります。そして、初期化子は { } で囲んでいるので、各要素毎に初期化を行うことになります。しかし、result の要素は <font color=red>char 型１つの配列</font>つまり<font color=red>１バイト</font>なので、これを文字列で初期化しようとしても<font color=red>初期化子が多すぎる</font>と言ってくるわけです。</p>

<p>　こういった表面的な意味はあるものの、これらのエラーは実質的にはエラーではありません。ただ、配列の２番目以降の添字を書き忘れると大抵こういったエラーが誘発されるので、エラーを素早く特定するための<font color=red>情報</font>にはなります。</p>

<p>　このように、<font color=red>同じ原因からは大体同じエラーが出る</font>ので、エラーの表面的な意味よりも<font color=red>実践的な意味</font>を覚えておくとよいでしょう。そして、<font color=red>エラーが誘発される過程を理解しようとする</font>と、エラーに対する理解も深まり、実践的な意味を理解する手助けになるでしょう。</p>

<hr>

<p>　他にも、多くのエラーを誘発するエラーがあります。それは、「{ } の整合性がとれていない」「構造体の名前を間違えた」「ヘッダファイルに実体を定義してしまった」というものです。</p>

<p>　先ず、{ } の整合性がとれていないと、それはそれは<font color=red>悲惨</font>になります。先ず、関数の定義範囲がおかしくなります。すると、「関数の中で関数を定義している」「関数外に代入だの関数呼び出しだのがある」、果ては「関数の途中でファイルが終わっている」だの言われてしまいます。最終的にはエラーが一度に表示できる最大数に達することも珍しくない、最悪のエラーです。</p>

<p>　しかし、最悪ではありますが直すのは簡単です。こういったときは<font color=red>一番初め</font>あたりにエラーがあるのでしたね。そのあたりで { } のバランスがどこかおかしくなっているはずです。そして、このせいで<font color=red>このエラー以降のエラーメッセージには全く価値はなくなってしまっている</font>ので、さっさとコンパイルし直してしまいましょう。</p>

<p>　普通はエディタがカッコと改行のバランスを取ってくれることが多いので、このエラーはそう頻繁に起こるものではありません。{ } を何度も増やしたり減らしたりしていると、ついついバランスが崩れてしまった、ということならあるでしょうね。{ } をマクロ BEGIN END に置き換えてやっていたので、エディタの機能が活かされずバランスが崩れてしまった、というのは<font size=+2 color=red>論外</font>なので、そういう人は早くＣ／Ｃ＋＋の文法に慣れて下さい。</p>

<p><br></p>

<p>　次に、構造体の名前を間違えたときです。例えば、構造体 SStudent があったとして、</p>

<pre>SStudnet student;</pre>

<p>と、<font color=red>e と n を逆さにしてしまった</font>とします。急いで打つと、たまにあることです。もしくは、SStudnet をヘッダファイルで定義していたときに、そのヘッダファイルを<font color=red>インクルードし忘れている</font>と同じ様な状態になりますね。</p>

<p>　このとき、コンパイラは「ある手段」を使います。それは、「SStudnet を <font color=red>int 型の変数の宣言と見なす</font>」という手段です。</p>

<p>　そして、宣言文の後はコンマかセミコロンかを要求するわけですが、残念ながら次は student です。なので、<font color=red>「セミコロンがない」</font>というエラーが出ます。そして、「ここにセミコロンがある」という「ある手段」を使います。で、次は student; ですが、ここも同じ事です。「student が宣言されていない」というエラーが出て、「student を int 型の変数の宣言と見なす」という「ある手段」を使います。</p>

<p>　さて、こうなると <font color=red>student は int 型の変数になってしまいました</font>。そうなると後は想像がつくでしょう。<font color=red>student を使っているあらゆるところでエラーが出てしまうのです！</font>　そのブロックの student の関わるエラーは無視してしまいましょう。</p>

<p><br></p>

<p>　最後はヘッダファイルに外部リンケージを持つ実体を定義してしまったときのエラーです。これは簡単ですね。リンクエラーとしての二重定義が何個も出てくるわけです。二重定義防止コードも、リンクエラーの二重定義は防ぐことはできません。まぁ、これは<a href="cpp01070.html" target="main">第７０章</a>で話したことなので、もういいですね。</p>

<p><br></p>

<p>　このように、<font color=red>沢山エラーが出ても原因は１つであるときもある</font>のです。数に惑わされないようにしましょう。もちろん、原因が沢山あるときもあるので、そのときは頑張って修正しましょう。</p>

<hr>

<p>　さて、今まではプログラムを作るときには「ビルド」（または「構築」「メイク」）を使ってきました。しかし、大きなプログラムになってくると、この時間もかなりのものになってきます。</p>

<p>　例えば、ヘッダファイルにエラーがあるとします。簡単な綴りの間違いでもいいです。そのエラーが出てもボーっとビルドが終わるまで待っていては時間の無駄です。ヘッダファイルのエラーは、そのヘッダファイルをインクルードした全てのファイルでエラーを出します。そして、ヘッダファイルのエラーを修正すると<font color=red>そのヘッダファイルをインクルードしている全てのファイルをコンパイルし直します</font>。そのヘッダファイルがかなりの数インクルードされていると、その時間はかなりのものになります。<font color=red>ヘッダファイルのエラーが出たら、早めにコンパイルをうち切ってしまいましょう</font>。</p>

<p>　しかし、そうなる前に手を打つことができます。<a href="cpp01070.html" target="main">第７０章</a>で言った通り、コンパイルは各ファイル毎に独立に行われます。つまり、各ファイル毎、単独にコンパイルしていくことができるはずです。そして、それはもちろんできます。</p>

<p>　コンパイルしたいソースファイルを開き、その上でメニューの「ビルド」から「コンパイル」を選びます。<font color=red>Ctrl+F7</font> キーでもいいです。そうすれば、単独にコンパイルすることができます。</p>

<p>　あるヘッダファイルと、そのヘッダファイルと関係の深いソースファイルを作ったときは、<font color=red>先ずそのソースファイルを単独でコンパイルします</font>。そして、エラーがなくなったところで、全体をコンパイルします。こうすれば、ヘッダファイルにエラーがあっても被害は１ファイルだけですみます。いちいちコンパイルを中断する必要もありません。</p>

<p>　このように、<font color=red>単独コンパイルを活用すれば、時間の節約になることがあります</font>。場合によっては全体をビルドした方がいいときもあります。とりあえず全体をビルドしてエラーを大体チェックし、その後に単独コンパイルを行っていくというのも手かもしれません。それは、時と場合によってその場で自分で判断しましょう。</p>

<hr>

<p>　では、今回の要点です。</p>

<font size=+2 color=red>
<ul>
<li>変なエラーが連続して現れるときは先頭のエラーに注目する。</li>
<li>同じ原因からは大体同じエラーしか出てこない。</li>
<li>ヘッダファイルが原因のエラーがあればビルドを中断しよう。</li>
<li>単独コンパイルを積極的に利用する。</li>
</ul>
</font>
<p><br></p>

<p>　とうとう次回で第１部は終わりです。次回は、第２，３部のイントロダクション的な回にしたいと思っています。第２，３部は平行して書いていくつもりです。</p>

<p>　それでは、次回まで。</p>

<hr>

<p align=right><a href="cpp01078.html" target="main">第７８章　逃げの一手</a> | <a href="cpp01080.html" target="main">第８０章　次のステップへ</a></p>
<p align=right><font size=-1><i>Last update was done on 2000.8.29</i></font></p>

<p align=right><font size=-1><i>この講座の著作権は<a href="http://www1.kcn.ne.jp/~robe/">ロベール</a>が保有しています</i></font></p>

</body>
</html>
