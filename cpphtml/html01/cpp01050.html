<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=x-euc-jp">
<title>ロベールのＣ＋＋教室 - 第５０章 命名法 -</title>
</head>
<body bgcolor=white>

<center>
<font size=6>第５０章　命名法</font>
</center>
<hr>

<p>　今回は５０章、つまり１００章の半分に達したということで、少し趣向の違うことをやりたいと思います。それは命名法、つまり、変数や関数の名前の付け方について話したいと思います。</p>

<p>　とはいっても、「こうでなくてはいけない！」という命名法などは特にありません。分かりやすい名前の付け方、一般的な使い分け、そういったことを話していきたいと思います。</p>

<hr>

<p>　今回の要点はこんな感じです。</p>

<font size=+2 color=red>
<ul>
<li>やたらと短い名前はなるべく避け、意味を持った名前を付ける。</li>
<li>変数の型や種類がある程度分かるようにする。</li>
<li>マクロはなるべく全て大文字にする。</li>
<li>長い名前は、単語の区切りが分かるようにする。</li>
</ul>
</font>
<p><br></p>

<p>　では、いってみましょう。</p>

<hr>

<p>　みなさん、変数や関数の名前はどのようにして付けていますか？　自分のルールを決めている人、他人に勧められたルールに従っている人、そして適当につけている人、いろいろいるでしょう。</p>

<p>　もちろん、Ｃ／Ｃ＋＋言語には決まった命名法などはありません。だからといって、あまり好き勝手に名前を付けていると、あとからプログラムを見たり、他人に見てもらったりするときに理解の妨げになります。ある程度一般的に広まっているルールや、自分なりのルールを身につけておくと、きっと役に立つことでしょう。</p>

<hr>

<p>　では、先ずは名前の長さについて話しましょう。</p>

<p>　この講座に出てくる変数名、関数名は、ある１つの例外を除いて、意味のよく分かる名前を付けています。もちろんいきなり一目見て「この意味しか考えられない」という程ではありませんが、前後関係、やりたいことを考えれば大体意味の分かるように付けているつもりです。</p>

<p>　初心者、または面倒臭がりな人はついつい１，２文字程度の名前で楽をしようとしてしまう事が多いようです。しかし、これは感心できません。よく分からない名前ばかり付けていると、ちょっと開発に間があくと意味がよく分からなくなり、バグの誘発にも繋がります。<font color=red>少々打つのが面倒だろうが、意味のよく分かる名前を付けるようにしましょう。</font>あまり長すぎるのも、誤入力の可能性があって逆に困りますけど。そこら辺は調整して下さい。</p>

<p>　ＶＣ＋＋６．０以降では省入力システムが導入されているので、ＶＣ＋＋６．０以降では幾分か楽になると思います。</p>

<p>　さて、「ある１つの例外」と言いましたが、これは for 文によく使っている変数 i の事です。もちろん、いつも for 文に i を使っているわけではありません。これは、「for 用の変数で、その変数がそれ以上の意味を持たない、または持たせる必要がないときには i を使う」というルールを設けているのです。これは一般的にも使われているので（ i ではないかもしれませんが）、特に反発することもないでしょう。もちろん、全てに意味ある名前を付けても構いません。</p>

<hr>

<p>　次は、変数の型や種類に関してです。</p>

<p>　この講座の変数には、数は n（ number の略）、文字列は sz（ string (zero-terminated) の略）、ポインタは p（ pointer の略）、というような接頭辞を付けています。こうしておくと、その変数がポインタなのか、数なのか、ということが一目で分かるようになります。</p>

<p>　どういうルールを設けるかは人によって少しずつ違いがあるみたいです。このルールをあまり好かない人もいるようです。ですが、ルールを持っておくと、理解の助けになります。<font color=red>変数にはなるべく接頭辞を付けて、型や種類がよく分かるようにしましょう。</font>最低でも、数値か、ポインタか、ははっきりしておくと便利です。</p>

<hr>

<p>　次は変数と関数、マクロの差別化に関してです。</p>

<p>　変数と関数、そしてマクロでは名前の付け方を少し変えておくといいでしょう。一般的には、変数には接頭辞を付ける、マクロは全て大文字にする、というものがあります。</p>

<p>　変数では、接頭辞を付けることがもう目印になります。接頭辞とその他のものを見分けられるように、続きは大文字で始めます。接頭辞を嫌う人には、全て小文字で書く人もいます。</p>

<p>　関数については、全て小文字にする、もしくは単語単位での先頭を大文字にする、という２種類があります。昔は前者が主流でしたが、現在は後者が主流です。これは趣味に任せていいでしょう。</p>

<p>　次はマクロですが、特別な理由がない限りマクロには全て大文字を使うようにしましょう。前に口を酸っぱくして言いましたが、マクロは変数や関数とは別の次元のものです。そして、マクロが原因の様々なバグも存在します。「これはマクロだ！」という目印があれば、注意して使うことができます。そのためにも、<font color=red>マクロは全て大文字で名前を付けるようにしましょう</font>。</p>

<p>　作業環境によって処理を分けるというテクニックの一環としてマクロに小文字を混ぜることもあります。しかしそれは特別な場合であり、普通のマクロでは大文字を使うようにしましょう。</p>

<hr>

<p>　最後は複数の単語を連ねた名前についてです。</p>

<p>　名前に意味を持たせようとすると、複数の単語を連ねて１つの変数名を作るようなことがよくあります。例えば、あるデータが有効かどうかを判定する関数の名前を is と valid（［形］有効な）の２つの単語を繋げて作る（"Is this valid?" という疑問文をもとにしています）、などです。</p>

<p>　この時 isvalid という関数名にしてしまうよりは、IsValid や is_valid という名前にした方が意味の区切りがよく分かり、読みやすくなります。この場合は合計文字数が７文字と少ないので isvalid でも大して気にならないかもしれませんが、これが長くなってくると一目では意味が分からなくなってしまいます。子音で終わる単語と母音で始まる単語を繋ぐと、さらに読みにくくなります。</p>

<p>　<font color=red>意味の単位の分かるように名前を付けましょう。</font></p>

<hr>

<p>　さて、命名法についてはこれで終わりです。命名法で一番大切なのは<font color=red>「分かりやすい」</font>ことです。それは<font color=red>「バグの軽減」</font>に繋がります。少しずつでいいので、自分なりのスタイルを身につけるようにしましょう。</p>

<p>　ただ、あまり独特なルールになりすぎると、誤解を招くこともあるかもしれません。標準的なルールに自分のルールを追加する形が一番いいのかもしれません。</p>

<hr>

<p>　さて、予告通り、これから<a href="cpp01048.html" target="main">第４８章</a>の問題の解答を発表します。問題は以下の通りでした。</p>

<blockquote><b>
<p>４４は４４、８１は８４、というように、その数以上の４の倍数のうち最も小さい数を求める式を作って下さい。</p>
</b></blockquote>

<p>　では、変換する方法を、式ではなく、先ずは言葉で表現してみましょう。</p>

<p>　先ずは順に変換前の値と変換後の値を列挙してみましょう。</p>

<table align=center border=1>
<colgroup>
<col>
<col align=center>
<col align=center>
<col align=center>
<col align=center>
<col align=center>
<col align=center>
<col align=center>
<col align=center>
<col align=center>
<col align=center>
</colgroup>
<tbody>

<tr>
  <th>変換前</th>
  <td>&nbsp;０&nbsp;</td>
  <td>&nbsp;１&nbsp;</td>
  <td>&nbsp;２&nbsp;</td>
  <td>&nbsp;３&nbsp;</td>
  <td>&nbsp;４&nbsp;</td>
  <td>&nbsp;５&nbsp;</td>
  <td>&nbsp;６&nbsp;</td>
  <td>&nbsp;７&nbsp;</td>
  <td>&nbsp;８&nbsp;</td>
  <td>&nbsp;９&nbsp;</td>
</tr>
<tr>
  <th>変換後</th>
  <td>０</td>
  <td>４</td>
  <td>４</td>
  <td>４</td>
  <td>４</td>
  <td>８</td>
  <td>８</td>
  <td>８</td>
  <td>８</td>
  <td>１２</td>
</tr>
</tbody></table>

<p>　すると、０は０、１〜４は４、５〜８は８、という風に、４つずつ値が並ぶことが分かります。まぁ、当然なんですけど。</p>

<p>　計算でとびとびの値を出すには、「ある数で割った余りを引く」というのが一般的に使われます。しかし、４で割った余りを引いても、０〜３は０、４〜７は４、８〜１１は８、という風にずれてしまいます。</p>

<p>　だからといって「余りを引く」という方法が使えないわけではありません。よく上の文を見れば解答が見えてくるはずです。では、上の文の一部を抜粋してみます。</p>

<p>１〜４は４、５〜８は８<br>４〜７は４、８〜１１は８</p>

<p>　これはもう答を言っているようなものですね。<font color=red>元の数に３を足して、それからその数を４で割った余りを引けばいいのです。</font></p>

<p>　これを式に直すと、元の数を x とすると</p>

<pre>(x + 3) - (x + 3) % 4</pre>

<p>ということになります。</p>

<p>　しかし、「余りを引く」ということは整数型の変数を使えば以下のように行うこともできます。</p>

<pre><font color=red>(x + 3) / 4 * 4</font></pre>

<p>　余りを引くということは、商に除数をかけることと同じ事です。それは割り算の商と余りと除数の関係式</p>

<pre>P = Q × x + R   （ P ÷ x = Q ... R のとき）</pre>

<p>から見てもよく分かることでしょう。</p>

<p>　このようにすれば問題の答となる数が得られます。</p>

<hr>

<p>　さて、ここまでは一般的な話です。普通はこれで正しい答なのですが、この問題はこれで終わりではありません。というのも、ここでは<font color=red>４の倍数</font>を求めるからです。</p>

<p>　４というのは２進数で表現すると１００です。４とは２進数ではとてもキリのいい数字で、このことが特殊な解答をもたらしてくれます。</p>

<p>　１つには、４で割る、４をかけるをビットシフトで行うことが考えられます。</p>

<pre>(x + 3) >> 2 << 2</pre>

<p>　しかし、これよりも効率のいい方法があるのです。</p>

<p>　もし、この問題が「１００の倍数」を求める問題としたらどうでしょうか？　その時は「１００で割った余りを引く」などと言わずに、<font color=red>「１，２桁目を切り捨てる」</font>と言ったはずです。Ｃ／Ｃ＋＋言語では１０進数にとって切り捨てる演算はできませんが、これが２進数にとってなら実現できるのです。</p>

<p>　そうですね。<font color=red>特定のビットを０に置き換えることのできるビット演算</font>である<font color=red>ＡＮＤ</font>を使えばいいのです。２進数で下２桁を０、他を１にした数値とＡＮＤをとれば、下二桁を切り捨てることができます。つまり、次のようになります。</p>

<p>(x + 3) & 0xFFFFFFFC</p>

<p>　int の大きさは３２ビットです。つまり、「２進数で下２桁を０、他を１にした数値」というのは 0xFFFFFFFC になります。</p>

<p>　しかし、この 0xFFFFFFFC というのは気持ち悪いですね。６４，１２８ビット機などには対応してくれません。（６４，１２８ビット機では int の大きさは普通は６４，１２８ビットになる<font color=red>はず</font>です。）</p>

<p>　そういうときには<font color=red>ＮＡＮＤ</font>を使います。「２進数で下２桁を０、他を１にした数値」というのは、「２進数で下２桁を１、他を０にした数値」つまり<font color=red>３</font>のＮＯＴをとったものです。つまり、</p>

<pre><font color=red>(x + 3) & ~3</font></pre>

<p>が答になります。ずいぶんすっきりしましたね。</p>

<p>　実はこのルーチンはビットマップを扱うときなどに必要になる、実用ルーチンです。そして同時に、アクロバティックな計算のいい練習材料にもなります。</p>

<p>　さぁ、あなたは正解できたでしょうか？</p>

<hr>

<p>　では、最後にもう一度要点をまとめておきます。</p>

<font size=+2 color=red>
<ul>
<li>やたらと短い名前はなるべく避け、意味を持った名前を付ける。</li>
<li>変数の型や種類がある程度分かるようにする。</li>
<li>マクロはなるべく全て大文字にする。</li>
<li>長い名前は、単語の区切りが分かるようにする。</li>
</ul>
</font>
<p><br></p>

<p>　次回からはいよいよファイルを扱ってみたいと思います。ファイルを扱えるようになるだけで、格段にできることの幅が広がることでしょう。</p>

<p>　それでは次回まで。</p>

<hr>

<p align=right><a href="cpp01049.html" target="main">第４９章　ビットでフラグ</a> | <a href="cpp01051.html" target="main">第５１章　ファイルのススメ</a></p>
<p align=right><font size=-1><i>Last update was done on 2000.7.4</i></font></p>

<p align=right><font size=-1><i>この講座の著作権は<a href="http://www1.kcn.ne.jp/~robe/">ロベール</a>が保有しています</i></font></p>

</body>
</html>
