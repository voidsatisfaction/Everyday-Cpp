<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=x-euc-jp">
<title>ロベールのＣ＋＋教室 - 第３６章 魔法の数 -</title>
</head>
<body bgcolor=white>

<center>
<font size=6>第３６章　魔法の数</font>
</center>
<hr>

<p>　検索しやすいデータ構造というものは、今までにいくつも提案されています。二分探索木もそうですし、二分探索ができることからソートされた配列もそうです。今回はこの話をもうちょっと進めてみましょう。</p>

<hr>

<p>　では、今回の要点です。</p>

<font size=+2 color=red>
<ul>
<li>様々なデータに対し、ある範囲にできるだけ一様に分布する整数を得る関数をハッシュ関数と呼ぶ。</li>
<li>返される値をハッシュ値と呼ぶ。</li>
<li>ハッシュ値によってデータを分類すると、検索時間が大幅に節約できる。</li>
</ul>
</font>
<p><br></p>

<p>　では、いってみましょう。</p>

<hr>

<p>　突然ですが、あなたはとある学校の生徒になったとします。そして、あなたは友達の酒井君から、新谷君にあるものを渡して欲しいと頼まれたとします（これらは便宜上適当に付けた名前です）。しかし、新谷君は酒井君の友達ではあるのですが、あなたとは面識はありません。さて、あなたはどうしますか？</p>

<p>　面倒だから他の人に任せる？　そういうことを言っちゃダメです。それでは話が進みません。先ず多分、酒井君に<font color=red>新谷君がどのクラスの人か</font>を聞くと思います。１年１組からしらみつぶしに探すようなことはしないと思います。なぜなら、クラスを聞いた方が<font color=red>断然速く見つかる</font>からです。</p>

<p>　このように、<font color=red>データを分類しておくと速く検索することができる</font>のです。このことを利用したデータの管理・検索法を<font color=red>ハッシュ法</font>と呼びます。</p>

<p>　ハッシュ法ではデータを<font color=red>ハッシュ関数</font>というものを使って分類します。この関数は特別な関数というわけではなく、<font color=red>あるデータを入れるとある一意に対応する値を返すだけ</font>の単純な関数です。<font color=red>返す値がある範囲にできるだけ一様に分布する</font>ようになっていれば、どんな関数でも構いません。そして、ハッシュ関数の返す値を<font color=red>ハッシュ値</font>と呼びます。</p>

<table align=left border=1>

<tr><td><img src="images/0303601.gif" width=240 height=500 alt="ハッシュ関数"></td></tr>

<tr><th>図．１　ハッシュ関数</th></tr>

</table>

<p>　例えば、左の図を見て下さい。上の灰色のデータをハッシュ関数に入れます。すると、赤色から紫色の値を返します。ここでは水色の値を返してきましたが、データによって赤色から紫色の７種類の値のどれかを返します。もちろん、データが同じ時は同じ色を返します。</p>

<p>　そして、上の例では酒井君がハッシュ関数の代わりになっています。酒井君（ハッシュ関数）に新谷君（データ）のクラス（ハッシュ値）を聞いていますね。<br clear=left><br></p>

<p>　あとは、このハッシュ値を使ってデータを分類すればいいだけです。次の図を見て下さい。</p>

<center><table border=1>

<tr><td><img src="images/0303602.gif" width=615 height=500 alt="ハッシュ表"></td></tr>

<tr><th>図．２　ハッシュ表</th></tr>

</table></center>

<p><br></p>

<p>　図の右半分は、ハッシュ値毎に分類されたデータです。赤色のデータは赤色のハッシュ値を返すデータです。他も同じようになっています。</p>

<p>　さっき入れた灰色のデータは水色のハッシュ値に対応していました。なので、<font color=red>追加するときは水色のデータを集めたところに追加</font>し、<font color=red>検索するときも水色のデータを集めたところを検索</font>すればいいわけです。これがハッシュ法です。</p>

<p>　最初の例では、新谷君（データ）を捜すには教えてもらったクラス（ハッシュ値）に行けばいいわけですね。あとは、このクラス内で新谷君（データ）を捜せばいいだけです。</p>

<hr>

<p>　では、実際問題の話をします。</p>

<p>　先ず、ハッシュ関数をどういったものにするかです。ハッシュ値を求めるのに時間がかかるようではハッシュ法を使う意味がありません。なので、<font color=red>ハッシュ関数はそれなりに簡単な処理にする必要があります</font>。</p>

<p>　「これが一番いい！」というものは、扱うデータの傾向によって多少変わってきます。どんなデータでもなるべく一様になるようなハッシュ関数を研究してみるのもいいかもしれません。しかし、ここではそういう難しいところまでは踏み込みません。簡単なものを紹介するに止めておきます。</p>

<p>　例えば、<font color=red>割り算の余り</font>などが便利です。特に、<font color=red>素数で割った余り</font>がいいですね。偶数の多いデータなど、多少偏りがあっても対処できます。文字列では、最初と最後と真ん中の文字コードの合計を素数で割った余りなどにするといいでしょう。</p>

<p>　次に、ハッシュ値に対応するデータをどう保存するかです。先ずは<font color=red>ハッシュ値をインデックスとする配列を使う</font>のはいいとして、その先のデータはどうしたらいいのでしょうか？　何の配列にすればいいのでしょうか？　この中での検索時間が遅ければ、これまたハッシュ法を使っても大した効果は得られません。</p>

<p>　これは簡単で、二分探索木やソートされた配列など、<font color=red>検索しやすいデータ構造を使えばいい</font>だけです。先ずはハッシュ法で大雑把に分類して、その後に細かい検索をしていくわけです。</p>

<p>　ハッシュ法を二重に使えばどうか、という話ですが、それはハッシュ値の範囲を広げることと同じです。ということで、ハッシュ法は一段階で構いません。また、データとハッシュ値とは一対一に対応しないので（ハッシュ値からデータが一意に定まらない）、最終的にはハッシュ法以外の検索が必要になります。</p>

<hr>

<p>　では、実際にプログラムを組んでみましょう。やたらと長いので<a href="cp030361.html" target=~_blank">別ページ</a>に載せておきます。</p>

<p>　ハッシュ法は<a href="../htmlword/words031.html" target="words">連想配列</a>のように、<font color=red>種類が多く、バラバラな値とデータを結びつける</font>のに役に立ちます。この操作を<font color=red>マッピング</font>とも呼びます。</p>

<hr>

<p>　では、今回の要点を振り返ってみましょう。</p>

<font size=+2 color=red>
<ul>
<li>様々なデータに対し、ある範囲にできるだけ一様に分布する整数を得る関数をハッシュ関数と呼ぶ。</li>
<li>返される値をハッシュ値と呼ぶ。</li>
<li>ハッシュ値によってデータを分類すると、検索時間が大幅に節約できる。</li>
</ul>
</font>
<p><br></p>

<p>　検索しやすいデータ構造にはまだデータベースに便利な<font color=red>Ｂ木</font>などがあるのですが、それは各自で調べてみて下さい。</p>

<p>　次回も検索をやりますが、検索しやすいデータ構造とは関係なくなります。それでは、次回まで。</p>

<hr>

<p align=right><a href="cpp03035.html" target="main">第３５章　大樹の如く２</a> | <a href="cpp03037.html" target="main">第３７章　速読法</a></p>
<p align=right><font size=-1><i>Last update was done on 2001.2.13</i></font></p>

<p align=right><font size=-1><i>この講座の著作権は<a href="http://www1.kcn.ne.jp/~robe/">ロベール</a>が保有しています</i></font></p>

</body>
</html>
